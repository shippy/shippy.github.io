---
import HomeIntro from "@/components/home/HomeIntro.astro";
import ThingsIDo from "@/components/home/ThingsIDo.astro";
import NameAndImage from "@/components/home/NameAndImage.astro";
import Base from "@/layouts/Base.astro";
import Cta from "@/partials/Cta.astro";
import { getCollection, getEntry } from "astro:content";
import { formatCollection } from "@/lib/utils/formatCollection";
import HomeArticles from "@/components/home/HomeArticles.astro";
import HomeSideProjects from "@/components/home/HomeSideProjects.astro";
import HomePresentations from "@/components/home/HomePresentations.astro";

const homepage = await getEntry("homepage", "index");
const {
  homeIntro,
  thingsIDo,
  sideProjects,
  presentations,
  articles,
  nameImage,
} = homepage.data;

const posts = await getCollection("blog");
const projects = await getCollection("side_projects");
const formattedPosts = formatCollection(posts, { limit: 3 });
const latestProject = formatCollection(projects, { limit: 1 })[0];
---

<Base>
  <HomeIntro data={homeIntro} />
  <ThingsIDo data={thingsIDo} />
  <HomePresentations data={presentations} />
  <HomeSideProjects data={sideProjects} project={latestProject} />
  <NameAndImage data={nameImage} />
  <HomeArticles data={articles} posts={formattedPosts} />
  <Cta />
</Base>
